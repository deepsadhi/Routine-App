(function(e,t){window.touchSlider=function(n){function y(e){p.removeClass(n.currentClass).eq(e).addClass(n.currentClass)}function b(e,n){var r=s.current;if(r!==e){e=e!==t?e:r+1;m.to(e,{complete:n})}}function w(e){m.to(s.current+1,{dirX:1,complete:e})}function E(e){m.to(s.current-1,{dirX:-1,complete:e})}function N(){if(x){C()}}function C(){x=true;if(!S){clearTimeout(T);T=setTimeout(function(){if(!m.moving&&!S){w()}},n.delay)}return n.container}function k(){clearTimeout(T);x=false;return n.container}function L(){var t=e(document),n,i,s=false,h,p,d,v,y,b,w,E,S,x,T,N=function(e){if(e.which>1){return}if(s){t.triggerHandler(f+"."+r)}s=true;i=false,n=e.timeStamp;y=x=0;h=[0,0,0,n];if(e.originalEvent.touches){t.one(u,C);return}e.preventDefault();d=v=e.pageX;E=S=e.pageY;w=c[0].offsetLeft;p=[0,0,0,d];t.bind(a,k);t.one(f+"."+r,L);m.moveStart(e)},C=function(e){if(e.originalEvent.touches.length!==1){return}d=v=e.pageX=e.originalEvent.touches[0].pageX;E=S=e.pageY=e.originalEvent.touches[0].pageY;b=T=0;w=(new WebKitCSSMatrix(window.getComputedStyle(c[0]).webkitTransform)).e;p=[0,0,0,d];t.bind(a,k);t.one(f,L);m.moveStart(e)},k=function(e){var t,n;if(e.originalEvent.touches&&o){if(e.originalEvent.touches.length!==1){return}t=e.pageX=e.originalEvent.touches[0].pageX;n=e.pageY=e.originalEvent.touches[0].pageY;b+=Math.abs(t-v);T+=Math.abs(n-S);if(Math.abs(b-T)>50){var r=b;b=Math.min(100,Math.max(0,b-T));T=Math.min(100,Math.max(0,T-r))}if(t===v){return}if(!i){if(b>T){e.preventDefault();i=true}else{L(e)}}}else{t=e.pageX;n=e.pageY;if(t===v){return}if(/msie/.test(navigator.userAgent.toLowerCase())){e.preventDefault()}}y+=Math.abs(t-v);x+=Math.abs(n-S);h.shift();h.push(e.timeStamp);p.shift();p.push(t);m.move(e,v);v=t;S=n},L=function(e){s=false;if(!e.originalEvent||e.originalEvent.touches){e.pageX=v;e.pageY=S}t.unbind(a,k);var r=h.length,i=0,o=0;while(--r>0){if(h[r-1]){var u=p[r]-p[r-1];i+=Math.abs(u)/(h[r]-h[r-1]);if(u!==0){o=u>0?-1:1}}}i=i/h.length;m.moveEnd(e,i,o,n,y,x);g=false;if(y+x>4){l.one("click",function(e){e.preventDefault()})}};l.bind(u,N)}n=n||{};var r=n.namespace||"touchslider",i=e(n.container);if(i.length!==1){i.each(function(){touchSlider({container:this})});return}n=e.extend({autoplay:false,delay:3e3,margin:5,viewport:"."+r+"-viewport",prev:"."+r+"-prev",next:"."+r+"-next",pagination:"."+r+"-nav-item",currentClass:r+"-nav-item-current",duration:350,mouseTouch:true},n);var s={current:0,step:b,next:w,prev:E,start:C,stop:k},o="ontouchstart"in window&&"WebKitCSSMatrix"in window,u="touchstart",a="touchmove",f="touchend",l=e(n.viewport,i),c=n.scroller?e(n.scroller,i):l.children(),h=c.children(),p=e(n.pagination,i);if(c.css("position")!=="absolute"){var d=l.height();l.css({height:d,position:"relative"});c.css({position:"absolute",left:0,height:d,width:1e5})}if(!o){u="mousedown";a="mousemove";f="mouseup"}h.css("position","absolute");var v=o?function(e,n,r){if(n===t){return(new WebKitCSSMatrix(getComputedStyle(e.jquery?e[0]:e).webkitTransform)).e}e.css({webkitTransitionDuration:r?r+"ms":"0",webkitTransform:function(e){return"translate3d("+(typeof n==="number"?n:n.call(this,e))+"px,0,0)"}})}:function(e,n){if(n===t){return parseInt((e.jquery?e[0]:e).style.left,10)}e.css("left",n)};if(o){h.css({webkitTransitionProperty:"-webkit-transform",webkitTransitionTimingFunction:"cubic-bezier(0,0,0.25,1)"})}v(h.not(h[0]),1e4);v(h.eq(0),0);var m=function(){var r=[0],i=[0],u=e.noop;return{moving:false,init:function(){c.bind("webkitTransitionEnd",function(){u()})},to:function(a,f){f=f||{};if(a>=h.length){a=0}else if(a<0){a=h.length-1}var l=n.duration,p=h.eq(a),d=e.inArray(a,r),g=0;c.stop();m.moving=true;clearTimeout(T);if(d!==-1){g=i[d]}else{var b,w=h.index(p);d=t;if(f.dirX===-1){i.unshift(0);r.unshift(w)}else if(f.dirX===1){i.push(0);r.push(w)}else{for(b=r.length-1;b>=0;b--){if(r[b]<w){i.splice(b+1,0,0);r.splice(b+1,0,w);d=0;break}}if(d===t){i.unshift(i);r.unshift(w)}}d=e.inArray(w,r);if(d===0){g=i[1]-(p.outerWidth()+n.margin);v(p,g);i[d]=g}else if(d===r.length-1){g=i[d-1]+h.eq(r[d-1]).outerWidth()+n.margin;v(p,g);i[d]=g}else{var E=p.outerWidth();p.css("opacity",0);g=i[d+1]-Math.round((E+n.margin)/2);i[d]=g;v(p,g);var S=g,x=r.length;for(b=d-1;b>=0;b--){S-=h.eq(r[b]).outerWidth()+n.margin;i[b]=S}var C=g;for(b=d+1;b<x;b++){C+=h.eq(r[b]).outerWidth()+n.margin;i[b]=C}for(b=0;b<x;b++){h.eq(r[b]).animate({left:i[b]},{duration:l,queue:false,complete:function(){if(p.is(this)){p.animate({opacity:1},l)}}})}}}if(f.pxInMs){l=Math.min(Math.max(Math.round(Math.abs(v(c))/f.pxInMs),100),l)}u=function(){v(h.not(p),-1e4);r=[h.index(p)];i=[g];if(f.complete){f.complete()}m.moving=false;N()};if(!o){c.animate({left:-g},{duration:l,queue:false,complete:u})}else{v(c,-g,l)}s.current=a;y(a)},stop:function(){if(o){v(c,v(c))}else{c.stop()}},moveStart:function(e){m.moving=true;clearTimeout(T);c.stop();m.startPageX=e.pageX;var t=v(c),n;m.leftCount=t;if(r[0]===0){if(i[0]+t>0){m.leftCount=t+(i[0]+t)*3}}else if(r[r.length-1]===h.length-1){n=i[r.length-1]+t;if(n<0){m.leftCount=t+n*3}}},move:function(e,t){var s=e.pageX-t,o=v(c),u=h.eq(r[0]),a=r.length-1,f=h.eq(r[a]),p,d,g;m.leftCount+=s;if(s>0){while(r[0]!==0&&o+i[0]+s>n.margin){p=h.eq(r[0]-1);d=i[0]-p.outerWidth()-n.margin;v(p,d);i.unshift(d);r.unshift(r[0]-1);a++;u=p}}if((s>0&&o+i[0]+s>0||s<0&&o+i[0]>0)&&r[0]===0){g=Math.min(Math.round((m.leftCount+i[0])/4),l.innerWidth()/2);s=g-(o+i[0])}if(s<0){while(!f.is(h.last())&&o+i[a]+s+f.outerWidth()+n.margin<l.innerWidth()){p=h.eq(r[a]+1);d=i[a]+f.outerWidth()+n.margin;v(p,d);i.push(d);r.push(r[a++]+1);f=p}}if((s>0&&o+i[a]<0||s<0&&o+i[a]+s<0)&&f.is(h.last())){g=Math.max(Math.round((m.leftCount+i[a])/4),-l.innerWidth()/2);s=g-(o+i[a])}v(c,o+s)},moveEnd:function(e,t,n,s,o,u){var a=r.length,f=v(c),p=a-1,d;if(i[0]+f>0){p=0}else if(i[r.length-1]+f<0){}else{d={pxInMs:t};var y,b,w=a-1,E=l.innerWidth();for(y=0;y<a-1;y++){b=i[y]+h.eq(r[y]).outerWidth()+f;if(b>0&&b>E-(i[y+1]+f)){w=y;break}}if(g){p=w}else{var S=a-1,x=Math.round(c.offset().left);for(y=0;y<a;y++){if(i[y]+x>e.pageX){S=y-1;break}}p=w;if(w===S&&e.timeStamp-s<1e3&&o+u>Math.sqrt(Math.pow(l.height(),2)+Math.pow(E,2))*.05){p=Math.max(0,Math.min(a-1,p+n))}}}p=r[p];m.to(p,d)}}}();m.init();if(o){var g=false;c.bind("webkitTransitionStart",function(){g=true});c.bind("webkitTransitionEnd",function(){g=false})}var S=false,x=false,T;l.hover(function(){clearTimeout(T);S=true},function(){S=false;N()});p.click(function(){b(p.index(this))});e(n.prev,i).click(function(){E()});e(n.next,i).click(function(){w()});if(n.mouseTouch){L()}if(n.autoplay){C()}i.data(r,s)};e.fn.touchSlider=function(e){e=e||{};e.container=this;touchSlider(e);return this}})(jQuery)
